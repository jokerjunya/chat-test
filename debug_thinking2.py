"""
æ€è€ƒåˆ†é›¢ãƒ‘ãƒ¼ã‚µãƒ¼ã®æ”¹è‰¯ãƒ†ã‚¹ãƒˆ
"""

from thinking_parser import ThinkingParser
import re

# å®Ÿéš›ã®APIå¿œç­”ã‚’ãƒ†ã‚¹ãƒˆ
test_response = """</think>

</think>

ç”³ã—è¨³ã‚ã‚Šã¾ã›ã‚“ã€ç¾åœ¨ã®å¤©æ°—æƒ…å ±ã¯æä¾›ã§ãã¾ã›ã‚“ã€‚æ¤œç´¢çµæœã«ã¯å¤©æ°—ã«é–¢ã™ã‚‹æƒ…å ±ã¯å«ã¾ã‚Œã¦ã„ã¾ã›ã‚“ã€‚æœ€æ–°ã®å¤©æ°—æƒ…å ±ãŒå¿…è¦ãªå ´åˆã¯ã€å¤©æ°—ã‚¢ãƒ—ãƒªã‚„å¤©æ°—äºˆå ±ã®ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆã‚’ã”ç¢ºèªãã ã•ã„ã€‚

ä¸€èˆ¬çš„ã«ã€æ­£ç¢ºãªå¤©æ°—æƒ…å ±ã‚’å¾—ã‚‹ãŸã‚ã«ã¯ï¼š
1. æ°—è±¡åºã®ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆ
2. Yahoo!å¤©æ°—ã‚„ã‚¦ã‚§ã‚¶ãƒ¼ãƒ‹ãƒ¥ãƒ¼ã‚¹ãªã©ã®å¤©æ°—ã‚¢ãƒ—ãƒª
3. ãƒ†ãƒ¬ãƒ“ã‚„ãƒ©ã‚¸ã‚ªã®å¤©æ°—äºˆå ±
ã‚’ã”åˆ©ç”¨ã„ãŸã ãã“ã¨ã‚’ãŠã™ã™ã‚ã—ã¾ã™ã€‚"""

print("=== æ”¹è‰¯ç‰ˆãƒ‘ãƒ¼ã‚µãƒ¼ãƒ†ã‚¹ãƒˆ ===")

# ç‰¹æ®Šã‚±ãƒ¼ã‚¹ç”¨ã®æ”¹è‰¯ãƒ‘ã‚¿ãƒ¼ãƒ³
def improved_parse(response):
    """æ”¹è‰¯ç‰ˆãƒ‘ãƒ¼ã‚µãƒ¼"""
    
    # </think>ã§å§‹ã¾ã‚‹å ´åˆã®ç‰¹æ®Šå‡¦ç†
    if response.startswith('</think>'):
        # </think>ã‚¿ã‚°ã‚’å…¨ã¦å‰Šé™¤ã—ã€æ®‹ã‚Šã‚’å›ç­”ã¨ã—ã¦æ‰±ã†
        cleaned_response = re.sub(r'</think>\s*', '', response).strip()
        
        # æ€è€ƒå†…å®¹ã¯ãªã—ã¨ã—ã¦æ‰±ã†ï¼ˆãƒ¢ãƒ‡ãƒ«ãŒä¸å®Œå…¨ã«ç”Ÿæˆã—ãŸå ´åˆï¼‰
        return {
            "has_thinking": False,  # å®Œå…¨ã§ãªã„æ€è€ƒã¯ç„¡åŠ¹ã¨ã™ã‚‹
            "thinking": "",
            "answer": cleaned_response,
            "original": response
        }
    
    # é€šå¸¸ã®ãƒ‘ãƒ¼ã‚µãƒ¼å‡¦ç†
    parser = ThinkingParser()
    return parser.parse_response(response)

result = improved_parse(test_response)

print("=== æ”¹è‰¯ç‰ˆçµæœ ===")
print(f"æ€è€ƒæœ‰ç„¡: {result['has_thinking']}")
print(f"æ€è€ƒå†…å®¹: '{result['thinking']}'")
print(f"å›ç­”å†…å®¹: '{result['answer'][:150]}...'")

# å®Ÿéš›ã«é©ç”¨ã—ã¦ã¿ã‚‹
print("\n=== é©ç”¨å¾Œã®è¡¨ç¤º ===")
if result['has_thinking']:
    print("ğŸ¤” æ€è€ƒãƒ—ãƒ­ã‚»ã‚¹:")
    print(result['thinking'])
    print()
print("ğŸ’¬ å›ç­”:")
print(result['answer']) 